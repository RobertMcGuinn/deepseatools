<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Downloading the data | Deep Sea Code Book</title>
  <meta name="description" content="2 Downloading the data | Deep Sea Code Book" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Downloading the data | Deep Sea Code Book" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Downloading the data | Deep Sea Code Book" />
  
  
  

<meta name="author" content="Robert P. McGuinn" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="creating-interactive-maps-using-leaflet.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i><b>1.1</b> License</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#disclaimer"><i class="fa fa-check"></i><b>1.2</b> Disclaimer</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="downloading-the-data.html"><a href="downloading-the-data.html"><i class="fa fa-check"></i><b>2</b> Downloading the data</a><ul>
<li class="chapter" data-level="2.1" data-path="downloading-the-data.html"><a href="downloading-the-data.html#using-erddap-to-download-data"><i class="fa fa-check"></i><b>2.1</b> Using ERDDAP to download data</a></li>
<li class="chapter" data-level="2.2" data-path="downloading-the-data.html"><a href="downloading-the-data.html#get-data-using-a-csv"><i class="fa fa-check"></i><b>2.2</b> Get data using a CSV</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="creating-interactive-maps-using-leaflet.html"><a href="creating-interactive-maps-using-leaflet.html"><i class="fa fa-check"></i><b>3</b> Creating interactive maps using Leaflet</a></li>
<li class="chapter" data-level="4" data-path="creating-a-simple-depth-summary-table.html"><a href="creating-a-simple-depth-summary-table.html"><i class="fa fa-check"></i><b>4</b> Creating a simple depth summary table</a></li>
<li class="chapter" data-level="5" data-path="example-rmarkdown-reports.html"><a href="example-rmarkdown-reports.html"><i class="fa fa-check"></i><b>5</b> Example RMarkdown Reports</a><ul>
<li class="chapter" data-level="5.1" data-path="example-rmarkdown-reports.html"><a href="example-rmarkdown-reports.html#example-1-r-markdown-for-word-document-output."><i class="fa fa-check"></i><b>5.1</b> Example 1: R-Markdown for Word document output.</a></li>
<li class="chapter" data-level="5.2" data-path="example-rmarkdown-reports.html"><a href="example-rmarkdown-reports.html#example-2-r-markdown-for-web-page-output."><i class="fa fa-check"></i><b>5.2</b> Example 2: R-Markdown for web page output.</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Deep Sea Code Book</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="downloading-the-data" class="section level1">
<h1><span class="header-section-number">2</span> Downloading the data</h1>
<p>In preparation for downloading and working with these data, you will need to load some additional R packages. The ‘install.packages’ commands below are commented out, so if you need to install, you will need to un-comment those before running this code.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="downloading-the-data.html#cb1-1"></a><span class="co"># install.packages(&quot;dplyr&quot;)</span></span>
<span id="cb1-2"><a href="downloading-the-data.html#cb1-2"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb1-3"><a href="downloading-the-data.html#cb1-3"></a><span class="co"># install.packages(&quot;rerddap&quot;)</span></span>
<span id="cb1-4"><a href="downloading-the-data.html#cb1-4"></a><span class="kw">library</span>(rerddap)</span>
<span id="cb1-5"><a href="downloading-the-data.html#cb1-5"></a><span class="co"># install.packages(&quot;leaflet&quot;)</span></span>
<span id="cb1-6"><a href="downloading-the-data.html#cb1-6"></a><span class="kw">library</span>(leaflet)</span>
<span id="cb1-7"><a href="downloading-the-data.html#cb1-7"></a><span class="co"># install.packages(&quot;RColorBrewer&quot;)</span></span>
<span id="cb1-8"><a href="downloading-the-data.html#cb1-8"></a><span class="kw">library</span>(RColorBrewer)</span>
<span id="cb1-9"><a href="downloading-the-data.html#cb1-9"></a><span class="co"># install.packages(&quot;ggplot2&quot;)</span></span>
<span id="cb1-10"><a href="downloading-the-data.html#cb1-10"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb1-11"><a href="downloading-the-data.html#cb1-11"></a><span class="co"># install.packages(&quot;rmarkdown&quot;)</span></span>
<span id="cb1-12"><a href="downloading-the-data.html#cb1-12"></a><span class="kw">library</span>(rmarkdown)</span>
<span id="cb1-13"><a href="downloading-the-data.html#cb1-13"></a><span class="co"># install.packages(&quot;knitr&quot;)</span></span>
<span id="cb1-14"><a href="downloading-the-data.html#cb1-14"></a><span class="kw">library</span>(knitr)</span></code></pre></div>
<div id="using-erddap-to-download-data" class="section level2">
<h2><span class="header-section-number">2.1</span> Using ERDDAP to download data</h2>
<p>Getting data directly from ERDDAP (Environmental Resource Division Data Access Protocol) using ‘rerddap’ package in R.</p>
<p>To see the meanings and valid values for all of the fields in National Database, download an Excel version of the full data dictionary following location: <a href="https://deepseacoraldata.noaa.gov/internal-documents/program-guidance/science-team-guidance-for-data-management/20170707.xlsx/at_download/file">LINK</a></p>
<p>Use the ‘info’ function from the ‘rerddap’ package to get information about the variables (fields) in the database. Note that the ‘Latitude’ and ‘Longitude’ fields are in ERDDAP as ‘latitude’ and ‘longitude’, with no capital letters. These are the only field names that differ from what is in the data dictionary.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="downloading-the-data.html#cb2-1"></a>info &lt;-<span class="st"> </span><span class="kw">info</span>(<span class="dt">datasetid=</span><span class="st">&#39;deep_sea_corals&#39;</span>, </span>
<span id="cb2-2"><a href="downloading-the-data.html#cb2-2"></a>              <span class="dt">url =</span> <span class="st">&quot;https://www.ncei.noaa.gov/erddap/&quot;</span>)</span></code></pre></div>
<p>Now take a look at the first 5 field names using the ‘head’ function.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="downloading-the-data.html#cb3-1"></a><span class="kw">head</span>(info<span class="op">$</span>variables)</span></code></pre></div>
<pre><code>##          variable_name data_type  actual_range
## 1              AphiaID       int -999, 1419323
## 2  AssociatedSequences    String              
## 3       AssociatedTaxa    String              
## 4        CatalogNumber       int    1, 1045199
## 5 CategoricalAbundance    String              
## 6             Citation    String</code></pre>
<p>To list all variables in the NOAA, National Database for Deep Sea Corals and Sponges , then use the following:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="downloading-the-data.html#cb5-1"></a>info<span class="op">$</span>variables</span></code></pre></div>
<p>When you have the variables (fields) that you want to download in mind after reviewing the data dictionary, you can download them using the following ‘tabledap’ function from the ‘rerddap’ package. In the code below, you can see an example of setting specific geographic bounding box constraints and selecting a particular Vessel. You can set any numeric or character-based constraint on your downloads using this basic syntax. If you set no contraints, you will download all data. <em>Warning</em>: If you add no constraints, the data download will take more time, so be patient.</p>
<p>You can also filter your data after downloading if you would prefer, rather than using constraints in the ‘tabledap’ function. This might be preferable if you want to intially download all of the data and all of the fields for exploration. The example below contains constraints. <em>Note</em>: Character constraints must be enclosed in double quotes. So the syntax for a constraint is: ‘Vessel=“Okeanos Explorer R/V”’. Variables can be listed in any order desired. Getting the full database may be preferable if you are using it regularly in your work.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="downloading-the-data.html#cb6-1"></a><span class="kw">library</span>(rerddap)</span>
<span id="cb6-2"><a href="downloading-the-data.html#cb6-2"></a>d &lt;-<span class="st"> </span><span class="kw">tabledap</span>(<span class="st">&quot;deep_sea_corals&quot;</span>, <span class="st">&#39;longitude&lt;50&#39;</span>, <span class="st">&#39;latitude&gt;20&#39;</span>, <span class="st">&#39;latitude&lt;30&#39;</span>, </span>
<span id="cb6-3"><a href="downloading-the-data.html#cb6-3"></a>              <span class="st">&#39;Vessel=&quot;Okeanos Explorer R/V&quot;&#39;</span>,</span>
<span id="cb6-4"><a href="downloading-the-data.html#cb6-4"></a>              <span class="dt">fields=</span><span class="kw">c</span>(<span class="st">&#39;DatabaseVersion&#39;</span>, <span class="st">&#39;CatalogNumber&#39;</span>, <span class="st">&#39;latitude&#39;</span>, <span class="st">&#39;longitude&#39;</span>, <span class="st">&#39;ScientificName&#39;</span>, <span class="st">&#39;ImageURL&#39;</span>, </span>
<span id="cb6-5"><a href="downloading-the-data.html#cb6-5"></a>                       <span class="st">&#39;Vessel&#39;</span>, <span class="st">&#39;RecordType&#39;</span>, <span class="st">&#39;DatasetID&#39;</span>, <span class="st">&#39;SurveyID&#39;</span>, <span class="st">&#39;SampleID&#39;</span>, <span class="st">&#39;TrackingID&#39;</span>,</span>
<span id="cb6-6"><a href="downloading-the-data.html#cb6-6"></a>                       <span class="st">&#39;Station&#39;</span>, <span class="st">&#39;Locality&#39;</span>, <span class="st">&#39;ObservationYear&#39;</span>, <span class="st">&#39;Genus&#39;</span>, <span class="st">&#39;Phylum&#39;</span>, <span class="st">&#39;TaxonRank&#39;</span>,</span>
<span id="cb6-7"><a href="downloading-the-data.html#cb6-7"></a>                       <span class="st">&#39;DepthInMeters&#39;</span>),</span>
<span id="cb6-8"><a href="downloading-the-data.html#cb6-8"></a>              <span class="dt">url =</span> <span class="st">&quot;https://www.ncei.noaa.gov/erddap/&quot;</span>)</span></code></pre></div>
<p>Check the size of the data frame that you just downloaded using the ‘dim’ function.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="downloading-the-data.html#cb7-1"></a>x &lt;-<span class="st"> </span><span class="kw">dim</span>(d)</span>
<span id="cb7-2"><a href="downloading-the-data.html#cb7-2"></a>x</span></code></pre></div>
<pre><code>## [1] 30562    19</code></pre>
<p>The dataframe that you downloaded contains 30562 rows (occurrences) by 19 fields.</p>
<p>Now list the names of the fields to check that you downloaded the fields that you wanted.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="downloading-the-data.html#cb9-1"></a><span class="kw">names</span>(d)</span></code></pre></div>
<pre><code>##  [1] &quot;DatabaseVersion&quot; &quot;CatalogNumber&quot;   &quot;latitude&quot;       
##  [4] &quot;longitude&quot;       &quot;ScientificName&quot;  &quot;ImageURL&quot;       
##  [7] &quot;Vessel&quot;          &quot;RecordType&quot;      &quot;DatasetID&quot;      
## [10] &quot;SurveyID&quot;        &quot;SampleID&quot;        &quot;TrackingID&quot;     
## [13] &quot;Station&quot;         &quot;Locality&quot;        &quot;ObservationYear&quot;
## [16] &quot;Genus&quot;           &quot;Phylum&quot;          &quot;TaxonRank&quot;      
## [19] &quot;DepthInMeters&quot;</code></pre>
<p>Now filter the downloaded data for only those records which have images and take a look at the ‘head’ of the dataframe.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="downloading-the-data.html#cb11-1"></a>d &lt;-<span class="st"> </span>d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">is.na</span>(d<span class="op">$</span>ImageURL) <span class="op">==</span><span class="st"> </span>F)</span>
<span id="cb11-2"><a href="downloading-the-data.html#cb11-2"></a><span class="kw">head</span>(d)</span></code></pre></div>
<pre><code>## &lt;ERDDAP tabledap&gt; deep_sea_corals
##    Path: [C:\Users\ROBERT~1.MCG\AppData\Local/Cache/R/rerddap/2f86982e23e0cc5e2ae70a1af066cd14.csv]
##    Last updated: [2021-03-11 07:28:50]
##    File size:    [8.72 mb]
## # A tibble: 6 x 19
##   DatabaseVersion CatalogNumber latitude longitude
##   &lt;chr&gt;                   &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;    
## 1 20201021-0             419497 26.46665 -84.77803
## 2 20201021-0             419498 26.46664 -84.77803
## 3 20201021-0             419499 26.46664 -84.77804
## 4 20201021-0             419500 26.46662 -84.77801
## 5 20201021-0             419501 26.46662 -84.778  
## 6 20201021-0             419502 26.46664 -84.778  
## # ... with 15 more variables: ScientificName &lt;chr&gt;,
## #   ImageURL &lt;chr&gt;, Vessel &lt;chr&gt;, RecordType &lt;chr&gt;,
## #   DatasetID &lt;chr&gt;, SurveyID &lt;chr&gt;, SampleID &lt;chr&gt;,
## #   TrackingID &lt;chr&gt;, Station &lt;chr&gt;, Locality &lt;chr&gt;,
## #   ObservationYear &lt;int&gt;, Genus &lt;chr&gt;, Phylum &lt;chr&gt;,
## #   TaxonRank &lt;chr&gt;, DepthInMeters &lt;chr&gt;</code></pre>
<p>Use the following loop function to browse the first 5 images in the set. The ‘ImageURL’ variable contains the URL of the hosted images. The ‘browseURL’ function will open the images in your default image editing program. Warning: Careful when using this function in a loop as it will open as many URLs as you feed it, so it could crash your computer.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="downloading-the-data.html#cb13-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">head</span>(d<span class="op">$</span>ImageURL)){</span>
<span id="cb13-2"><a href="downloading-the-data.html#cb13-2"></a>  <span class="kw">browseURL</span>(i)</span>
<span id="cb13-3"><a href="downloading-the-data.html#cb13-3"></a>}</span></code></pre></div>
</div>
<div id="get-data-using-a-csv" class="section level2">
<h2><span class="header-section-number">2.2</span> Get data using a CSV</h2>
<p>Alternatively, you can upload data directly from CSV file into R, if you already have a subset of the National Database on your local machine that you would like to use instead.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="downloading-the-data.html#cb14-1"></a><span class="kw">setwd</span>(<span class="st">&quot;C:/your/working/directory&quot;</span>)</span>
<span id="cb14-2"><a href="downloading-the-data.html#cb14-2"></a>d &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data_records.csv&quot;</span>, <span class="dt">header =</span> T)</span></code></pre></div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="creating-interactive-maps-using-leaflet.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
